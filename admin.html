<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Editrix — Admin Dashboard</title>
<style>
  :root{--yellow:#ffd400;--black:#0b0b0b;--white:#fff;--muted:#9a9a9a}
  *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,var(--black),#050505);color:var(--white)}
  .container{width:min(1100px,94%);margin:18px auto;padding:18px}
  header{display:flex;justify-content:space-between;align-items:center}
  .card{background:linear-gradient(180deg,#0b0b0b,#090909);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.04);box-shadow:0 18px 50px rgba(0,0,0,.6)}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:12px;margin-top:12px}
  .list{max-height:520px;overflow:auto}
  .msg{padding:10px;border-bottom:1px solid rgba(255,255,255,.03)}
  .logout{background:var(--yellow);color:#111;padding:8px 12px;border-radius:999px;border:0;font-weight:800;cursor:pointer}
  .note{color:var(--muted);font-size:13px}
  @media (max-width:980px){ .grid{grid-template-columns:1fr} }
</style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h2 style="margin:0">Editrix Admin</h2>
        <div id="adminEmail" style="color:var(--muted)">—</div>
      </div>
      <div>
        <button class="logout" onclick="doLogout()">Logout</button>
      </div>
    </header>

    <div class="grid">
      <div class="card list" id="messagesList">
        <div style="font-weight:900;margin-bottom:8px">Messages</div>
        <div id="msgs">Loading…</div>
      </div>

      <div class="card">
        <div style="font-weight:900;margin-bottom:8px">Chats</div>
        <div id="chats" style="max-height:420px;overflow:auto"></div>
      </div>
    </div>

    <div style="margin-top:12px" class="note">Data is stored locally in this browser (localStorage). For real persistence, connect a backend (Firebase / server).</div>
  </div>

<script>
  // check login
  const auth = JSON.parse(localStorage.getItem('editrix_admin')||'null');
  if(!auth || !auth.logged){ alert('Not signed in. Redirecting to login.'); location.href='login.html'; }
  document.getElementById('adminEmail').textContent = auth.email;

  function renderMessages(){
    const store = JSON.parse(localStorage.getItem('editrix_messages')||'[]');
    const wrap = document.getElementById('msgs');
    if(!store.length){ wrap.innerHTML = '<div style="color:var(--muted)">No messages yet.</div>'; return; }
    wrap.innerHTML = '';
    store.forEach(m=>{
      const d = document.createElement('div'); d.className='msg';
      d.innerHTML = `<div style="font-weight:800">${escapeHtml(m.name)} <span style="color:var(--muted);font-weight:600">(${escapeHtml(m.service||'')})</span></div>
                     <div style="color:var(--muted);font-size:13px">${escapeHtml(m.email)} • ${new Date(m.created).toLocaleString()}</div>
                     <div style="margin-top:8px">${escapeHtml(m.message)}</div>`;
      wrap.appendChild(d);
    });
  }

  function renderChats(){
    const arr = JSON.parse(localStorage.getItem('editrix_chats')||'[]');
    const box = document.getElementById('chats');
    if(!arr.length){ box.innerHTML = '<div style="color:var(--muted)">No chat messages</div>'; return; }
    box.innerHTML = '';
    arr.forEach(c=>{
      const p = document.createElement('div'); p.style.padding='8px'; p.style.borderBottom='1px solid rgba(255,255,255,.03)';
      p.innerHTML = `<div style="color:var(--muted);font-size:12px">${new Date(c.created).toLocaleString()}</div><div style="margin-top:6px">${escapeHtml(c.text)}</div>`;
      box.appendChild(p);
    });
  }

  function escapeHtml(s){ if(!s) return ''; return s.replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  function doLogout(){ localStorage.removeItem('editrix_admin'); location.href='login.html'; }

  // initial render
  renderMessages(); renderChats();

  // auto-refresh every 2.5s so admin sees new messages saved in other tabs
  setInterval(()=>{ renderMessages(); renderChats(); }, 2500);
</script>
</body>
</html>
